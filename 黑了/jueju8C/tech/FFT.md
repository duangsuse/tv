# 傅里叶变换

这是夜空的延时摄影。单独照片只有位置，多加几张就有了速度。镜头里同物体近快远慢，喇叭里同声音怎算快慢？

在几天前，小律家有盘钟坏了，她定期地照了12张照片，我们把它按序号-=标准1Hz秒针角度，把秒针拨回来，就只听到相同秒针的声音

章鱼兄喜音律，他用嘴吹了竖笛音域上两个音：8孔竖笛=有8个时分秒的钟，wav文件=每秒44100张照片，wav按序号*y倍速基准音 再叠加，得孔y在1s声波内开口响度。

“频域”y的个数自定、每y的响度不止01。它能表达世界上所有的声、光、电、点线图、数学函数，请看！标题

## 交集

Fourier Transform 是音乐软件声效+动效、电音制作，甚至锐化/压缩图片、医疗B超时依赖的步骤。 尽管跨界得如此成功，理解它的人少之又少

古董MP3的液晶屏、“古典” “摇滚”等音效就是你和它最近的接触-但不是指“浴室” “大厅”等混响-那要看下一期。我们就从“频谱”开始信号处理的旅程吧！

《绿野仙踪》里有绿色的太阳-当然要戴滤镜。 绿色涂料只反射，或只让绿光通过，这样尽管光波变弱，你就只见调色板中“绿”的成分；红蓝3D眼镜也以此拆分相差几cm两相机的内容-透过红片看蓝色是最黑的：红蓝在频谱上位置相反

尽管光波只=频率+震幅 就像可乐=4块钱，当你设置颜色时，可以用RGB三原色的叠加描述光，也能调奶茶以适自己的口味。数据拆分让我们能做更全面的调整和识别

比如蓝绿扣图。在LCD屏幕和CMOS相机，物理上以3点为1像素 就能读写RGB。 既然光透绿片就能调整三色的强弱，声音的“绿片”，就是基频正弦波

>FT就是把输入拆成(数量自定)基频×强度的和，白光、白噪音在所有频有强度。 `#ffffff`(ff*3)

对声音、“震动的线”f(t=0~1)，`F(y)=Int (y*2jpi)*t  f(t) dt`

- `F` 是此波形的频谱
- `f(t)` 是采样，dt是(1/份数)
- `(y*2jpi)*t` 基频 指圆点在f内转y 圈，y多精度高(上限=t内转t圈)
- ^等同 `s(ty); s(x)=sin(x 2pi)` 即给线s以播放速度y 

另外，
- Int dt求和t的区间，即积分。j是虚数"1",其乘法代表旋转
- 图表软件Desmos 精度d(=0.001,.)恒定 只能 `1/n Int[0~n] dt` 增n以精细

把f和每基频，相乘总和即准确震幅，好像会越加越大，但请看圆圈系 `r=sin kt` (t=0~2pi,k=1)，只有正弦波相重叠，即震动与缠绕速度相同，才会在(y>0)给出和为(0,1)的点集，正如 sin*cos 小于两者

某频率/veloc 值 Vec2(0,1)的力是震幅amp，角则是相位phase，sin的周期是2pi，相位即0~<2pi

>对了，只取震幅，也需要Vec"2"和旋转来计算FT吗？

没错。这就得说傅里叶级数与方波，先按下不表。

你学到了FT正反函数，即对每频y 加权求和。
- `采样f(x)=s(.5x)+s(x)`
- `频谱F(y)=Int s(-yx) f(x) dx` (负y 待会讲)
- `重震f1(x)=Int F(y) s(yx) dy` IFT逆变换
- `计算机 s(i/n)*f[i]` s在f内1圈叫1Hz，f(n=1s=44100pps)

## 细节

正常人都不难发现只需等1s，看哪个指针动 那就是秒针-它会周期性前进与归0，但对混杂的波形，周期的直觉就无法使用。

数学的本意是拓宽人的直觉，既如此，直觉比答案乃至算法更为必要。以上我们收获了直觉

开头的动画就是把频以震幅降序，播放(t=0~1) 单频箭头的累加&外圆圈 (所以幅最大的圈不一定最慢，你想到了吗？)

进度条回0，sin(x)的FT 用旋转不好理解，但对中心对称“表盘”就很直观

假设这钟的指针秃了，靠3点角度*长度之相较标准频率，也能拿回3个长度和初始位置，甚至能概括的拿3+或3-个，这就是均衡器EQ的柱子数 和变声器的质量高中低了。

>“都拨回”很好理解，拨正的话角度=mod(t+t,2pi) 就不对了？

复数乘法=的旋转(xX-yY,xY+yX) 在XY的cossin角度=0 时得原点，是基于三角恒等式。你也可以故意写反(xY-yX,xX+yY) 分析分析

mod(t+t)在右侧象限滞留时间更久，依然会体现频谱。前面F(y) f1(x) 内基频s符号相反就能还原，具体差异就是课题啦。

## FFT

在谈FFT之前，先回答开头竖笛音 相乘的叠加(点积,多项式=加权求和)，为何只剩我们想听的音符

声音是对称的，`{f(x)<0: -f(x-周期), f(x)}` 还原了f=sin。其实只有y>0 ，即频谱上正频率的部分有用，如果只统计正频率，工作量直接减少1半，把工作二分再统计，减少到1/4 即 2**-2

变声器的 Numpy 版本

```py
```

已经能处理1s音频，但耗时>1s 。人耳的范围是20~20kHz ，一般音乐80~2k 也够了。周深的key 可以高至D6:86，按C6:84算=1046Hz

>MIDI `key(y)=440*2**((y-69)/12 )` ，A4:69=440, 风琴最低C2:36=65 钢琴A0:21=30

## STFT

把起起落落的频谱柱左翻90，用亮度代表高度，你就得到了音高线。

题外话，要提取音高f0，恒Q法和log 重映射的FT更常用。

## 傅里叶级数

傅里叶提出“无周期=周期无限长!=无迹可循”，打通了数学和电控间的悬浮。而像方波、锯齿这样根本不像sin的线，也能用添加频域插值的方法逼近（_甚至能用正余弦“谐波”外的基频 但保真度低_），但你忽视了一点，sin是奇函数。

>无论什么频率 sin(0)=0 _且s(-x)=-sx_，对了，刚刚也没说连续与离散(D)FT 的区别，毕竟现实是有帧率和时长限制的！

我们可以用(周期?)方波试下sin,cos 的 Fourier Series-你不能否认现代音乐中存在这种成分

>FT 对偶方波、cos级数对奇方波 0~1:1 否则0 的结果很像，但cos其实无法处理奇函数-y向对称，还原f1就是x向对称，sin也类似！

刚才说“缠绕”或旋转只是对复数乘法的具象化，并不代表求和后数据的y(即real)值永远是0，或者说只靠震幅就能100%还原波形。 现代数学 ρ=θ/2π 都能拉丁化为 r=t/2π 却不愿合并向量与复数，__复指数对傅里叶奇+偶双数列的拯救有不少绩效。__

对f(x,y) 进行FT 相当于按y分行，每行做f(x)的FT ，得到灰度图或3D柱图。

对图像而言，相位S远比频率L重要，记得开头的RGB吗？HSL(色相亮度)：同色不同相能以颜色深浅塑造独特风格。对绿扣图，限定HSL.H也比RGB.G 精准，因为青和柠檬黄的G值也能是255。应用如找图内贴图的位置 OpenCV.phaseCorrelate

当然，FFT 在任何拆解出系数对计算有利的领域都可能以奇怪的术语出现，别忘 `频y的强度=sum(基频y倍速*线)的“圆心距”力`，你就掌握了调频的心智模型。

频域也有些特质，如其加法等同在时域、图形越钝频域越尖；好课不囊万物，请搜索相关数学。

## 末
>批判性思维 本质化 分而调之

1807年在热物理提出的FT已是电工学(EE)必修理论，你看到的视频+bgm、美颜滤镜、网站对图床和剪辑结果的储存、语音输入和识别，看似无异从前十几兆的wav和bmp。也许不能像均衡器手动修改频域，也许其结果像跳动的柱图只作装饰，也许它只是庞大拟合过程里、信号处理的某一步，但傅里叶对函数之定义大胆的质疑，赋予我们探索更多座标系特征、兼容无限输入类型的契机。

线，是连续的，但震动却能拆分。拉格朗日不愿接受“理论不纯粹”的逼近法，让这种契机沉没了15年之久。 我们爱正确，但更爱真理；人们怕疏漏，但不敢忘掉进步。

这期视频包含我对相关不解的答案：

- 为何图像和声音都叫“信号”
- 离散和连续FT里那些希腊字母有何作用
- 仅仅相乘求和为何=震幅
- 复数FT和仅sin的FS有何联系，相位的存在与意义用何举例
- 为何1维的声音靠sin 1维叠加不够表达

“不好”“不想”“不接受”，学渣般的恶人口吻下却是概念革新的前奏。也许把“懂不懂”放下，才敢于看清出界的已知与未知；总在用圆融把心中的座标忘掉，才发现起起落落外的同频者和亘古如此的真知

186年后，FFT的出现令FT真正脱离如本期视频般的小实验，技术于历史相乘，数和程序的结合才让正负频的对称性得到优化；所以我认为编程语言，一定要是能协调所有空洞浮华的符号，『描述这世界语言的语言。』

对知识系统的分析和非平凡的变换，或是机械改名套弄，在这里都重回平凡，就像领域间本无差距隔阂存在。造于基础，还于基础。

任何理论刚出现时都不名一文，但科学的道路，却是无论坍塌多少次都在重演的“原来如此”，像给柠檬汁加点盐，像把煮面拆为面饼和配料包，是平凡也蕴含的道理。

作为无亲无故无代码基 又有学习成本 的新语言，绝句正是把“通识上盖基础”视为自然界般的法则，希望织成它的某些通识，已与你产生共振，创造只属于你和其领域新事物；也希望你能如它一样，莫把代码视为微不足道的“万般下品”，却为成为会说中文的程序员而改变执见。

## 引

- Desmos技巧 [快速积分](https://www.desmos.com/calculator/jw6bhl1ujz?lang=zh-CN): `A=a([1...N]) (N<M)` 可缓存频谱
- [实现](https://www.desmos.com/calculator/it3dxsrarf) 频域越密，时域越疏
- [奇偶无相位FT](https://www.desmos.com/calculator/vmg3jrwglb?lang=zh-CN)
