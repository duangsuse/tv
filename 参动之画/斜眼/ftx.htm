<canvas id=eG><script>doc=document;c={dt:.0005,nK:40}
with(Math){DEG=2*PI,转=(r,f)=>f(sin(r),cos(r))}
律=(k,f)=>{let cx=0,yi=0,d=c.dt, t=f.pop?(f=just(f),d= 1):0;for(;t<=1;t+=d)
  转(k*t*DEG,(X,Y)=>{let[x,y]=f(t); yi+=x*X+y*Y ;cx+=x*Y-y*X}) //可缓存k*t个数据
  return[d*cx,d*yi]//k 也标明震幅+-和正统计/反还原
}
n=o=>o.length, newA=(n,f)=>{let a=Array(n),i=0;for(;i<n;i++)a[i]=f(i) ;return a}, just=k=>()=>k
//^律(k,[x,y]) 能还原波形  ^待会用于填充频谱

//DFT:把 转(ktDEG,(X,Y)=>.. 变多项式，即可乘 f[i],k转[i], k转=newA(nK* 1/dt,(i,r=i/nK*DEG )=>[cos,sin])，+-k 也可变为仅-k，另一半是反向量 。
简画=ps=>{
let N=c.nK,谱=newA(2*N,i=>律(i-N,ps)), /*内俩频动量*/a0,a, P=录点(),/*序*/f=([k,p])=>pLen(律(k,p))
谱=谱.map((p,i)=>[i-N,p]).sort((b,a)=> f(a)-f(b))
return t=>{
  a=L.map(v=>v/2);let l=Math.min(...L)*c.wImg, k,p;
  for([k,p]of 谱){a0=[...a];J(a,律(k*-t,p),(a,b)=>(a+b*l)); 连线(a0,a);a0=a} P(a)
}}

录点=(a=[])=>p=>{a.push(p); a.forEach(p=>g.fillRect(...p,3,3))}
连线=(a,b)=>g.fillRect(...a,3,3)

J=(a,b,op)=>{for(let i=0;i<2;i++)a[i]=op(a[i],b[i]) ;return a}, pLen=([x,y])=>Math.sqrt(x*x+y*y)
for(let k of"+-*/")J[k]=eval(`(a,b,op)=>a.map((x,i)=>x${k}b[i])`)

eAdd=(e0=> (s,op)=>{e0.innerHTML=s;let e=doc.body.appendChild(e0.firstChild); return op(c=>e.querySelector(c))}
)(doc.createElement('eloader'))
布=e=>{e.width=e.offsetWidth;e.height=e.offsetHeight;return e.getContext("2d")}

svgPoints=(u,q=u[0]=='<')=>eAdd(q?u: `<svg><path>`,e=>{e=e('path');if(!q)e.setAttribute('d',u)
  let l=e.getTotalLength(),L=pWH(e),p//center to (0,0),norm to +-1
  return 切分(t=> J([(p=e.getPointAtLength(t*l)).x,p.y],L, (a,b)=>a/b*2-1))
})

/*2D“画圆时手抖”折线->频幅谱->动画t:各频分量t%的0点差->累积在屏心,幅wImg*whMin 连线不同频圆圈:以len降序
(nK个频,1/dt次割圆)*/切分=(f, N=1/c.dt>>0)=>newA(N, i=>f(i/N))
pWH=o=>{let f=o=>[o.width,o.height]
  return o.width?f(o):f(o.getClientRects()[0]) }

eG.style.cssText=`width:100%;height:100%`; g=布(eG);L=pWH(eG)
g.strokeStyle="#888"
c.wImg=.3
{
a=svgPoints(`M84.73,19.64h41.09c-9.82,40.72-16,67.27-16,96.36,0,5.09,0,44.36,14.91,44.36,7.63,0,14.18-6.91,14.18-13.09,0-1.82,0-2.54-2.55-8-9.82-25.09-9.82-56.36-9.82-58.91a283.69,283.69,0,0,1,7.64-60.72h40.73c4.72,0,16.72,0,16.72-11.64,0-8-6.9-8-13.45-8H58.54C50.18,0,37.82,0,21.09,17.82,11.64,28.36,0,47.64,0,49.82s1.82,2.91,4,2.91c2.55,0,2.91-1.09,4.73-3.28C27.64,19.64,46.54,19.64,55.64,19.64H76.36c-8,27.27-17.09,58.9-46.91,122.54-2.9,5.82-2.9,6.55-2.9,8.73,0,7.63,6.54,9.45,9.81,9.45,10.55,0,13.46-9.45,17.82-24.73C60,117.09,60,116.36,63.64,101.82Z`)
a=svgPoints(`M 84.996743,170.6845 C 14.14891,159.53715 -0.370557,66.654007 64.067845,36.799251 72.096944,33.079326 71.840015,31.440259 62.57362,27.266858 53.435174,23.151098 52.002112,24.946031 75.146575,11.519296 98.736527,-2.1658614 94.607944,-1.416272 108.22345,5.5139233 c 12.1532,6.1858787 20.40819,9.3400057 35.7372,13.6546937 11.14985,3.138375 12.50276,3.871886 8.68708,4.709938 -1.46768,0.322541 -2.66853,0.769444 -2.66853,0.993561 0,7.106926 8.08932,26.47827 11.40459,27.310366 2.59543,0.651395 13.28047,12.602157 15.10493,16.894159 0.71176,1.674412 1.98731,5.303303 2.83455,8.06423 1.72182,5.611034 2.5794,4.590132 -7.28554,8.672858 -2.91449,1.206224 -2.91449,1.206224 -2.46864,10.612821 2.14864,45.33189 -38.96745,81.43348 -84.572347,74.25795 z  m 31.364757,-3.398 C 170.84386,151.69441 186.32994,83.477377 143.42177,48.08472 132.32992,38.935634 126.69757,36.754694 119.52861,38.832818 93.632185,46.339747 83.182701,46.467982 73.930571,39.392496 69.109788,35.705802 68.655618,35.745574 59.990203,40.612845 -12.397287,81.271961 36.101787,190.25574 116.3615,167.2865 Z  M 73.574245,147.86763 C 58.9079,143.9174 46.056534,132.71891 37.069857,116.0582 c -4.380389,-8.12096 -3.944117,-8.70807 2.423169,-3.26104 27.995711,23.94962 61.258294,25.11742 92.470454,3.24649 8.06374,-5.65044 8.49931,-4.89815 2.04388,3.53002 -17.99447,23.49334 -40.001764,33.79688 -60.433115,28.29396 z  m 13.541839,-6.80274 c 0,-7.26693 0,-7.26693 -4.090419,-7.7838 -2.249725,-0.28446 -5.15607,-0.68587 -6.458541,-0.89238 -2.36813,-0.37549 -2.36813,-0.37549 -2.36813,6.88365 0,7.25912 0,7.25912 3.229268,7.78605 1.776102,0.29 3.810542,0.64994 4.52098,0.80028 5.117404,1.08287 5.166842,1.01789 5.166842,-6.7938 z  m 13.326716,4.20618 c 3.55921,-1.48714 5.07486,-15.13815 1.52792,-13.76132 -0.82884,0.32157 -4.122692,0.80691 -7.319685,1.07815 -5.812695,0.49322 -5.812695,0.49322 -5.812695,8.00099 0,8.08682 1.758188,8.79621 11.60446,4.68218 z  m -28.146542,-6.46126 c -0.250124,-6.93856 -0.250124,-6.93856 -6.062799,-8.89223 -8.840354,-2.97127 -9.232265,9.11938 -0.430571,13.28327 7.082789,3.35075 6.779819,3.55563 6.49337,-4.39104 z  m 40.309712,-0.55525 c 1.96372,-1.8021 3.03155,-8.47689 1.58721,-9.92124 -3.03191,-3.03191 -8.99318,2.65955 -8.99318,8.58616 0,6.87444 1.14484,7.08082 7.40597,1.33508 z  m -53.921808,-5.20797 c -0.01431,-5.81267 -0.01431,-5.81267 -5.166832,-8.58844 -5.152499,-2.77573 -5.152499,-2.77573 -5.125115,1.29173 0.02994,4.47104 0.432657,5.15824 5.787785,9.88012 4.688237,4.13389 4.520963,4.22984 4.504162,-2.58341 z  m 65.460458,-6.88909 c 5.2e-4,-3.32435 0.1917,-3.28764 -4.7128,-0.90484 -3.89816,1.89387 -3.89816,1.89387 -3.89816,6.5063 0,4.61247 0,4.61247 4.30525,0.90485 3.52224,-3.03329 4.30535,-4.21666 4.30571,-6.50631 z  m -77.505349,-2.15286 c -0.0031,-3.42006 -0.315543,-3.90101 -4.769239,-7.34067 -5.429252,-4.19313 -5.25249,-3.14951 1.097456,6.47952 3.597996,5.45601 3.67592,5.47426 3.671783,0.86115 z  m 86.941139,-6.20947 c 1.28896,-1.63776 1.26419,-1.64844 -0.82399,-0.35632 -6.49016,4.01597 -6.88909,4.41454 -6.88909,6.88261 0,2.58585 1.62126,1.21406 7.71308,-6.52629 z  M 55.762472,87.514178 c -0.730423,-1.903445 1.481121,-4.179878 3.360214,-3.4588 0.874145,0.33543 1.31304,1.289805 1.1432,2.485873 -0.34338,2.418143 -3.672809,3.137431 -4.503414,0.972927 z  m 41.135086,0.100901 c -0.299432,-0.780379 0.01953,-1.984324 0.712096,-2.675458 1.723069,-1.723038 4.307526,-0.608272 3.976036,1.715029 -0.32661,2.289029 -3.897565,3.020621 -4.688132,0.960429 z  m 71.764072,-4.514591 c -0.26299,-1.302465 -0.74025,-3.046267 -1.0609,-3.875141 -0.32059,-0.828841 -0.21547,-1.50699 0.23401,-1.50699 0.44934,0 1.29266,1.587804 1.87411,3.528418 0.58142,1.940613 1.26882,3.316667 1.52757,3.057919 0.25875,-0.258749 0.038,-1.710571 -0.49027,-3.226318 -1.16888,-3.353119 -1.21774,-4.481653 -0.16597,-3.831526 0.43719,0.270139 1.04827,1.644924 1.35799,3.054923 0.30984,1.410034 0.9818,2.822475 1.4936,3.138765 0.62096,0.383795 0.73993,-0.114245 0.35757,-1.497096 -1.59338,-5.762897 -1.65046,-6.191052 -0.75132,-5.635345 0.50627,0.312776 1.17481,1.726974 1.4857,3.14241 0.31083,1.415468 0.89491,2.573555 1.29785,2.573555 0.40293,0 0.37214,-1.256867 -0.0684,-2.793019 -1.49846,-5.224864 -0.4345,-5.480325 1.55956,-0.374452 1.06888,2.736906 1.06888,2.736906 0.56157,-0.276976 -1.78706,-10.616498 -7.32255,-17.35714 -12.38077,-15.076215 -4.21402,1.900287 -4.2042,1.379828 -0.24054,12.708065 3.21542,9.189964 4.32598,11.434501 3.40868,6.889121 z  m -1.45964,-23.392456 c 0,-1.789335 -5.113,-6.10155 -7.2346,-6.10155 -2.68975,0 -3.11094,3.564122 -0.92158,7.797931 1.28802,2.490722 8.15618,1.062236 8.15618,-1.696381 z  M 151.40554,48.377647 c -3.24627,-6.278605 -4.97776,-10.858028 -5.75596,-15.223198 -0.61218,-3.433804 -1.34065,-6.243259 -1.61886,-6.243259 -10.81256,0 -19.35357,7.965777 -12.35073,11.518897 6.01266,3.050694 13.77831,9.062901 19.16034,14.834001 6.11037,6.552097 6.17784,5.96892 0.56521,-4.886441 z  m 6.32391,4.019845 c 0,-0.191376 -1.53986,-3.582087 -3.4219,-7.534983 -1.88206,-3.952895 -3.908,-9.802791 -4.50208,-12.999784 -1.03711,-5.580863 -3.28689,-8.256713 -3.25809,-3.875109 0.0452,6.890001 7.26016,24.757738 9.99704,24.757738 0.65179,0 1.18503,-0.156551 1.18503,-0.347862 z`)
f=简画(t=>a[t*n(a) >>0]),t=0
setInterval(()=>{g.clearRect(0,0,...L);f(t+=c.dt)}, 1000/30)}

画风={S:'.stroke',F:'.fill'}
画=(ak,...a)=>Function(ak,fold(chunk(a,2),(s,[a,b])=>s+
(([_,c,k])=>`G=new Path2D;G.${k}(x,y,${b});g${画风[c]}(G);`)(/(.)(.+)/.exec(a)),'let [x,y]=a,G;'))

fold=(s,f,ac)=>(s(x=>{ac=f(ac,x)}) ,ac)
chunk=(a,N)=>f=>{for(let i=0,i1;i<n(a);i=i1)f(a.slice(i,i1=i+N))}

连线=画('a,b','Farc','2,0,DEG', 'SmoveTo(...b);G.lineTo','...b','Sarc',"pLen(J['-'](a,b)),0,DEG")
</script>
